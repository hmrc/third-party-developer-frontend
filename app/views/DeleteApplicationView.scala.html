@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ApplicationConfig
@import domain.models.views.BackButtonWithJavaScript
@import include._
@import domain.models.applications.CollaboratorRole
@import domain.models.developers.DeveloperSession
@import domain.models.applications.Application
@import domain.models.applications.Environment

@this(devMain: DevMain2)

@(app: Application, roleOfLoggedIn: CollaboratorRole)(
implicit request: play.api.mvc.Request[Any], loggedIn: DeveloperSession, messagesProvider: MessagesProvider, applicationConfig: ApplicationConfig)

@devMain(
  title = "Delete application",
  userFullName = loggedIn.loggedInName,
  back = BackButtonWithJavaScript,
  developerSession = Some(loggedIn)
) {
  <h1 class="govuk-heading-l">Delete application</h1>

  @appEnvironment2(app)

  <br>

  @if(roleOfLoggedIn == CollaboratorRole.ADMINISTRATOR) {
    @if(app.deployedTo == Environment.SANDBOX) {
      <p class="govuk-body">
        Before deleting this application, check with all your 
        <a class="govuk-link" href="@routes.ManageTeam.manageTeam(app.id, None)">
          team members
        </a>.
      </p>

      <a class="govuk-button" href="@routes.DeleteApplication.deleteSubordinateApplicationConfirm(app.id)">
        Continue
      </a>
    } else {
      <p class="govuk-body">
        Before requesting to delete this application, check with all 
        <a class="govuk-link" href="@routes.ManageTeam.manageTeam(app.id, None)">
          team members
        </a>.
      </p>

      <p class="govuk-body">
        We'll respond to your request within 2 working days.
      </p>

      <a class="govuk-button govuk-button--warning" href="@routes.DeleteApplication.deletePrincipalApplicationConfirm(app.id, None)">
        Request deletion
      </a>
    }
  } else {
    <div class="govuk-inset-text">
      You cannot delete this application because you're not an administrator.
    </div>

    @defining(app.collaborators.filter(_.role.isAdministrator)) { administrators =>
      @if(administrators.size == 1) {
        <p class="govuk-body">
          Ask the administrator <a class="govuk-link" href="mailto:@administrators.head.emailAddress">@administrators.head.emailAddress</a> to delete it.
        </p>
      } else {
        <p class="govuk-body">
          Ask one of these administrators to delete it:
        </p>
        <ul class="govuk-list govuk-list--bullet">
          @for(admin <- administrators) {
            <li>
              <a class="govuk-link" href="mailto:@admin.emailAddress">@admin.emailAddress</a>
            </li>
          }
        </ul>
      }
    }
  }
}
